<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Quick Actions - SEA Catering</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <div x-data="quickActionsTest()" class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-8">Test Quick Actions</h1>
        
        <!-- Quick Actions Test -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Quick Actions Test</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <button
                    @click="testLoadSubscriptions()"
                    class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-3 rounded-lg font-medium transition-colors"
                >
                    <i class="fas fa-clipboard-list mr-2"></i>
                    Test Load Subscriptions
                </button>
                
                <button
                    @click="testLoadContacts()"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg font-medium transition-colors"
                >
                    <i class="fas fa-envelope mr-2"></i>
                    Test Load Contacts
                </button>
                
                <button
                    @click="testExportData()"
                    class="bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg font-medium transition-colors"
                >
                    <i class="fas fa-download mr-2"></i>
                    Test Export Data
                </button>
                
                <button
                    @click="testGenerateReport()"
                    class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-3 rounded-lg font-medium transition-colors"
                >
                    <i class="fas fa-chart-bar mr-2"></i>
                    Test Generate Report
                </button>
            </div>
        </div>

        <!-- Results -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Test Results</h3>
            <div class="space-y-2">
                <div x-show="results.subscriptions" class="p-3 bg-green-50 border border-green-200 rounded">
                    <strong>Subscriptions:</strong> <span x-text="results.subscriptions"></span>
                </div>
                <div x-show="results.contacts" class="p-3 bg-blue-50 border border-blue-200 rounded">
                    <strong>Contacts:</strong> <span x-text="results.contacts"></span>
                </div>
                <div x-show="results.export" class="p-3 bg-green-50 border border-green-200 rounded">
                    <strong>Export:</strong> <span x-text="results.export"></span>
                </div>
                <div x-show="results.report" class="p-3 bg-purple-50 border border-purple-200 rounded">
                    <strong>Report:</strong> <span x-text="results.report"></span>
                </div>
                <div x-show="results.error" class="p-3 bg-red-50 border border-red-200 rounded">
                    <strong>Error:</strong> <span x-text="results.error"></span>
                </div>
            </div>
        </div>
    </div>

    <script>
        function quickActionsTest() {
            return {
                results: {
                    subscriptions: '',
                    contacts: '',
                    export: '',
                    report: '',
                    error: ''
                },

                async testLoadSubscriptions() {
                    console.log('Testing loadSubscriptions...');
                    this.clearResults();
                    
                    try {
                        const response = await fetch('/api/subscriptions');
                        console.log('Subscriptions response status:', response.status);
                        
                        if (response.ok) {
                            const result = await response.json();
                            console.log('Subscriptions data:', result);
                            const count = result.data ? result.data.length : (Array.isArray(result) ? result.length : 0);
                            this.results.subscriptions = `Loaded ${count} subscriptions successfully`;
                        } else {
                            const errorText = await response.text();
                            console.error('Subscriptions error:', errorText);
                            this.results.error = `Subscriptions API failed: ${response.status}`;
                        }
                    } catch (error) {
                        console.error('Subscriptions error:', error);
                        this.results.error = `Subscriptions error: ${error.message}`;
                    }
                },

                async testLoadContacts() {
                    console.log('Testing loadContacts...');
                    this.clearResults();
                    
                    try {
                        const response = await fetch('/api/contact');
                        console.log('Contacts response status:', response.status);
                        
                        if (response.ok) {
                            const result = await response.json();
                            console.log('Contacts data:', result);
                            const count = result.data ? result.data.length : (Array.isArray(result) ? result.length : 0);
                            this.results.contacts = `Loaded ${count} contacts successfully`;
                        } else {
                            const errorText = await response.text();
                            console.error('Contacts error:', errorText);
                            this.results.error = `Contacts API failed: ${response.status}`;
                        }
                    } catch (error) {
                        console.error('Contacts error:', error);
                        this.results.error = `Contacts error: ${error.message}`;
                    }
                },

                async testExportData() {
                    console.log('Testing exportData...');
                    this.clearResults();
                    
                    try {
                        const response = await fetch('/admin/export', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-Requested-With': 'XMLHttpRequest'
                            }
                        });
                        console.log('Export response status:', response.status);
                        
                        if (response.ok) {
                            const blob = await response.blob();
                            console.log('Export blob size:', blob.size);
                            this.results.export = `Export successful (${blob.size} bytes)`;
                        } else {
                            const errorText = await response.text();
                            console.error('Export error:', errorText);
                            this.results.error = `Export failed: ${response.status} - ${errorText.substring(0, 100)}`;
                        }
                    } catch (error) {
                        console.error('Export error:', error);
                        this.results.error = `Export error: ${error.message}`;
                    }
                },

                async testGenerateReport() {
                    console.log('Testing generateReport...');
                    this.clearResults();
                    
                    try {
                        const response = await fetch('/admin/report', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-Requested-With': 'XMLHttpRequest'
                            },
                            body: JSON.stringify({
                                start_date: '2025-06-01',
                                end_date: '2025-07-01',
                                type: 'comprehensive'
                            })
                        });
                        console.log('Report response status:', response.status);
                        
                        if (response.ok) {
                            const result = await response.json();
                            console.log('Report result:', result);
                            if (result.success) {
                                this.results.report = `Report generated successfully: ${result.filename}`;
                            } else {
                                this.results.error = `Report failed: ${result.message}`;
                            }
                        } else {
                            const errorText = await response.text();
                            console.error('Report error:', errorText);
                            this.results.error = `Report failed: ${response.status} - ${errorText.substring(0, 100)}`;
                        }
                    } catch (error) {
                        console.error('Report error:', error);
                        this.results.error = `Report error: ${error.message}`;
                    }
                },

                clearResults() {
                    this.results = {
                        subscriptions: '',
                        contacts: '',
                        export: '',
                        report: '',
                        error: ''
                    };
                }
            }
        }
    </script>
</body>
</html>
